# BolashakBot — Система университетского чат-бота

## Общее описание

BolashakBot — это билингвальная (русский/казахский) система чат-бота, разработанная для Кызылординского университета «Болашак», чтобы помочь абитуриентам получить информацию о поступлении, программах и требованиях. Система использует Flask как веб-фреймворк и интегрируется с Mistral AI для интеллектуальных ответов на основе базы знаний FAQ.

## Предпочтения пользователя

Стиль общения: простой, разговорный язык.  
Требования к дизайну виджета: минималистичный, чистый интерфейс в стиле сайта университета (белый фон, серый/чёрный текст, без ярких акцентных цветов).

## Архитектура системы

Приложение построено по традиционной архитектуре веб-приложения с ключевыми компонентами:

### Фронтенд
- **Технологии:** HTML5, Bootstrap 5, чистый JavaScript
- **Интерфейс:** одностраничное приложение с встроенным виджетом чата
- **Стилизация:** пользовательский CSS с фреймворком Bootstrap и иконками Font Awesome
- **Адаптивность:** мобильная версия с разворачивающейся навигацией

### Бэкенд
- **Фреймворк:** Flask (Python)
- **Архитектурный паттерн:** модульная структура с Blueprint
- **ORM:** SQLAlchemy с расширением Flask-SQLAlchemy
- **Управление сессиями:** Flask-сессии для аутентификации администратора
- **API:** RESTful endpoints для работы чата

### Дизайн базы данных
- **По умолчанию:** SQLite (для разработки)
- **Готово к продакшену:** возможность настройки PostgreSQL через переменную окружения DATABASE_URL
- **Схема:** реляционная БД с корректными внешними ключами
- **Миграции:** управление таблицами через SQLAlchemy

## Ключевые компоненты

### Модели (`models.py`)
- **Category:** Билингвальные категории для организации FAQ
- **FAQ:** Пары вопрос-ответ на двух языках с привязкой к категориям
- **UserQuery:** Логи диалогов с аналитикой
- **AdminUser:** Система авторизации для административного доступа

### Blueprints
- **Главный** (`views.py`): публичный чат и API
- **Админ** (`admin.py`): админ-панель и управление
- **Аутентификация** (`auth.py`): авторизация и сессии

### Интеграция ИИ
- **Клиент Mistral AI** (`mistral_client.py`): интеграция с внешним API для обработки естественного языка
- **Получение контекста** (`utils.py`): поиск по базе FAQ и подготовка контекста
- **Билингвальная поддержка:** языковые системные подсказки и ответы

### Административные функции
- **Дашборд:** статистика и аналитика
- **Управление FAQ:** создание, редактирование и удаление вопросов и ответов
- **Управление категориями:** организация контента
- **Аналитика диалогов:** отслеживание взаимодействий пользователей и метрик

## Поток данных

1. **Взаимодействие пользователя:** сообщение через виджет чата
2. **Получение контекста:** поиск релевантной информации в базе FAQ
3. **Обработка ИИ:** генерация ответа Mistral AI с учётом контекста
4. **Доставка ответа:** отправка отформатированного ответа пользователю
5. **Логирование аналитики:** сохранение данных для анализа в админке

### API endpoints
- `POST /api/chat`: основной endpoint для сообщений пользователя
- `GET /auth/verify-session`: проверка сессии администратора
- Админ-маршруты с префиксом `/admin/` для функций управления

## Внешние зависимости

### Сторонние сервисы
- **Mistral AI API:** основной сервис ИИ для генерации ответов
- **Bootstrap CDN:** фреймворк для стилизации фронтенда
- **Font Awesome CDN:** библиотека иконок

### Python-пакеты
- **Flask:** маршрутизация и веб-фреймворк
- **SQLAlchemy:** ORM и управление БД
- **Werkzeug:** утилиты безопасности (хэширование паролей, прокси)
- **Requests:** HTTP-клиент для внешних API

### Переменные окружения
- `DATABASE_URL`: строка подключения к базе данных
- `MISTRAL_API_KEY`: ключ API для сервиса Mistral AI
- `SESSION_SECRET`: секрет для управления сессиями

## Стратегия деплоя

### Разработка
- **Точка входа:** `main.py` (debug режим)
- **Локальная БД:** SQLite с автоматическим созданием таблиц
- **Hot reload:** сервер Flask с debug=True

### Продакшен
- **База данных:** настройка PostgreSQL через DATABASE_URL
- **Безопасность:** конфигурация секретов через переменные
- **Прокси:** поддержка ProxyFix middleware для обратного прокси
- **Сессии:** безопасная обработка сессий с настройками секретов

### Инициализация БД
- **Скрипт:** `setup_db.py` для инициализации данных
- **Утилиты:** `database.py` для управления таблицами и сброса
- **Дефолтный контент:** предустановленные категории и примеры FAQ

### Производительность
- **Пул соединений:** опции SQLAlchemy для управления соединениями
- **Трекинг времени ответа:** аналитика для оптимизации
- **Готово к кешированию:** архитектура поддерживает внедрение кеша

Система легко развёртывается на различных платформах с минимальными изменениями конфигурации, сохраняя модульность и разделение ответственности для будущих расширений.
